## 반응형 프로그래밍의 원칙
- 잠시 반응형 프로그래밍이 뭔지 설명하면서 7장을 시작한다
- 반응형 프로그래밍은 자료 스트리밍의 기초를 이루기 때문
- 반응형 프로그래밍은 자료 스트림에 대한 조작으로서 로직을 표현하는 프로그래밍 패러다임으로, 함수형 프로그래밍을 기반으로 함
- 반응형 프로그래밍 선언문에 잘 정리되어있는데 이 선언문에는 아래와 같은 특성이 필요하다.
  - 응답성
  - 회복성
  - 유연성
  - 메시지 주도
- 이 네가지를 이해하기 위해 예시를 들어보다
- 인터넷이 너무 느려서 인터넷 회사에 전화를 거는 상황을 상상해본다. 머릿속에 상황을 그렸는가, 그러면 시작해본다.

### 응답성 원칙
- 전화가 연결될 때 까지 얼마나 기다릴 용의가 있는가?
- 이는 사안이 얼마나 시급한지, 그리고 얼마나 시간이 많은지에 따라 다름
- 급한 상황이라면 곧 전화를 끊어버릴것임
- 그 끔찍한 통화 연결음을 들으면서 얼마나 기다려야 할지도 모르기 때문
- 그런 시스템은 응답성이 낮은 시스템임. 웹 시스템에서도 이런 일이 일어남
  - 웹 서버로 전송된 요청이 다른 요청이 처리되는 동안 큐에 묶여서 처리되지 않고 기다릴 수 있음
- 반면 응답성이 높은 콜센터라면 상냥한 목소리로 대기인 수가 몇 명인지, 또는 얼마나 기다려야 하는지를 알려줄 것
- 두 경우 모두 전화기를 붙잡고 시간을 버려야 한다는 사실은 똑같음. 하지만 두번쨰 시스템의 고객의 필요에 응답했고, 고객은 이를 바탕으로 결정을 내릴 수 있음.

### 회복성 원칙
- 이번에는 회복성(resilience) 원칙을 알아본다.
- 10분째 상담원을 기다리고 있었는데 갑자기 전화가 끊겼다고 가정
  - 이런 시스템은 실패에 대한 회복성이 낮은 것이고 리액티브 선언문은 회복성을 높이기 위한 여러 방법을 권고함
- 위임(delegation)
  - 콜센터에서 이렇게 말할 수 있음 "저희는 현재 인터넷 속도 문제를 해결하기 어렵다. 다른 곳으로 연결해주겠다."
- 복제(replication)
  - 그러고 나서 이렇게 말할 수 있다. "현재 많은 고객님이 대기중인 관계로 상담원을 추가 배치할 예정임"
  - 이는 다음 절에서 다루는 유연성의 원칙과도 연결됨
- 격리(containment) 또는 고립(isolation)
  - 결국 자동 응답기에서 이렇게 말함
  - 기다리기 어려우시면, 전화번호를 남겨 주시기 바랍니다.
  - 상담이 가능할 때 전화 드리겠다.
  - 격리란 이 시스템이 갖고 있는 확장성 문제에서 고객을 분리시키는 것
  - 반면 고립이란 시스템에 통화 불안정이라는 문제가 있더라도 신경쓰지 않는 것

### 유연성의 원칙
- 앞의 절에서 복제를 언급함
  - 실패를 방지하기 위해서는 항상 최소한 3명의 상담원이 필요하다고 한다.
  - 3명 모두 상담을 하고 있을때도 있고, 3명 모두 통화를 기다리고만 있을 때도 있을 것
  - 그런데 만약 사나운 두더지가 인터넷 통신선을 씹어 먹어 버렸다면 무슨 일이 생기나
  - 갑자기 잔뜩 화가 난 고객들의 전화가 폭주할 것
  - 콜센터에 전화기가 3대 뿐이라면 할 수 없지만, 사용할 수 있는 자원이 더 있다면 사고를 처리하고 고객을 진정시키기 위한 상담원으 ㄹ더 데려올 수 있을 것
  - 통신선 복구가 완료된 후에는 추가로 데려왔던 상담원은 원래 하던 일을 하고록 하는 것
  - 이런 시스템은 작업량에 유연하게 반응하는 시스템
- 유연성은 확장성을 기반으로 함
- 예를들어 모든 상담원이 전화기를 하나씩 갖고 독립적으로 일할 수 있다면 콜센터는 모든 수신 전화를 처리할 수 있을 것.
- 그러나 전화기 수보다 상담원 수가 더 많다면 전화기 수가 병목이 돼 어떤 상담원은 잔화를 받지 못할 것

### 메시지 주도 원칙
- 메시지 주도 원칙을 비동기 메시지 전달이라고 표현하기도 함
  - 앞서 상담원에게 다시 전화해달라고 메시지를 남길 수 있도록하면 시스템의 회복성이 더 높아진다는 것을 봄
  - 모든 고객이 항상 메시지만 남기도록 하면 어떤가
  - 그러면 상담원은 메시지간 우선순위를 결정하거나 일괄 처리하는 것이 가능할 것
  - 예를들어 요금 납부 내역서를 상담 중간중간 출력하는 대신 한꺼번에 몰아서 출력할 수 잇음ㄴ
- 메시지를 사용하면 배압을 적용하는 것도 가능함
- 어떤 상담원이 너무 많은 메시지를 받으면 과로로 쓰러질 수 있음
- 이를 막기위해 응답에 더 많은 시간이 걸릴 수 있다는 문자 메시지를 고객에게 전송할 수 있음
- 여기서는 다시 위임 이야기도 할 수 있고, 모든 원칙은 서로 겹치는 부분이 있기 때문
- 메시지는 논블로킹 방식이기도 함, 메시지를 보내놓고 상담원이 응답할 떄 가지 가만히 앉아서 기다릴 필요가 없다는 것
- 전화기를 내려놓고 다른 일을 하면 됨
- 기다리는 동안 다른 작업을 할 수 있도록 하는 것은 동시성의 핵심 요소임
- 이번 절에서는 반응형 프로그래밍의 네 가지 원칙을 배움
- 반응형 애플리케이션은 응답성, 회복성, 유연성, 메시지 주도라는 특징을 가짐
- 다음 절에서는 이 원칙들이 어떻게 코틀린에 적용돼있늕를 살펴볼 것
- 먼저 집합 자료구조부터 시작하면 반응형 프로그래밍 용어로는 집합 자료구조를 정적 자료 스틂이라고 부름